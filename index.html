<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ãªã¤ã‹ã—ã‚¯ã‚¤ã‚º - é ­ã®ä½“æ“</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    * {
      -webkit-tap-highlight-color: transparent;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
      background: #e0e5ec;
      min-height: 100vh;
      margin: 0;
      padding: 0;
    }
    .neu-btn {
      background: #e0e5ec;
      box-shadow: 8px 8px 16px #b8bcc2, -8px -8px 16px #ffffff;
      transition: all 0.2s ease;
    }
    .neu-btn:active {
      box-shadow: 4px 4px 8px #b8bcc2, -4px -4px 8px #ffffff;
      transform: scale(0.98);
    }
    .neu-btn-sm {
      background: #e0e5ec;
      box-shadow: 6px 6px 12px #b8bcc2, -6px -6px 12px #ffffff;
    }
    .neu-card {
      background: #e0e5ec;
      box-shadow: 12px 12px 24px #b8bcc2, -12px -12px 24px #ffffff;
    }
    .neu-inset {
      background: #e0e5ec;
      box-shadow: inset 6px 6px 12px #b8bcc2, inset -6px -6px 12px #ffffff;
    }
    .neu-progress {
      background: #e0e5ec;
      box-shadow: inset 4px 4px 8px #b8bcc2, inset -4px -4px 8px #ffffff;
    }
    .correct-btn {
      background: linear-gradient(145deg, #86efac, #4ade80);
      box-shadow: 8px 8px 16px #b8bcc2, -8px -8px 16px #ffffff;
    }
    .wrong-btn {
      background: linear-gradient(145deg, #fca5a5, #f87171);
      box-shadow: 8px 8px 16px #b8bcc2, -8px -8px 16px #ffffff;
    }
    .selected-female {
      background: linear-gradient(145deg, #fce7f3, #fbcfe8);
      box-shadow: inset 4px 4px 8px #d1d5db, inset -4px -4px 8px #ffffff;
    }
    .selected-male {
      background: linear-gradient(145deg, #dbeafe, #bfdbfe);
      box-shadow: inset 4px 4px 8px #d1d5db, inset -4px -4px 8px #ffffff;
    }
    .submit-btn-active {
      background: linear-gradient(145deg, #bbf7d0, #86efac);
    }
    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
    .animate-bounce {
      animation: bounce 0.6s ease infinite;
    }
    .animate-pulse {
      animation: pulse 0.8s ease infinite;
    }
    input::placeholder {
      color: #9ca3af;
    }
    input:focus {
      outline: none;
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script>
    // ã‚¢ãƒ—ãƒªã®çŠ¶æ…‹ç®¡ç†
    const state = {
      // ç”»é¢åˆ¶å¾¡
      screen: 'welcome', // 'welcome', 'nameInput', 'categorySelect', 'quiz', 'result'
      // åå‰é–¢é€£
      userName: '',
      userGender: null, // 'female' or 'male'
      // ã‚¯ã‚¤ã‚ºé–¢é€£
      currentQ: 0,
      score: 0,
      streak: 0,
      feedback: null,
      selectedAnswer: null,
      showHint: false,
      category: null,
      questions: []
    };

    // ä¸‹ã®åå‰ã ã‘ã‚’å–å¾—ï¼ˆè‹—å­—ã‚’é™¤ãï¼‰
    function getFirstName(fullName) {
      if (!fullName) return '';
      const trimmed = fullName.trim();
      const parts = trimmed.split(/[\sã€€]+/);
      if (parts.length >= 2) {
        return parts[parts.length - 1];
      }
      return trimmed;
    }

    // æ•¬ç§°ä»˜ãã®åå‰ã‚’å–å¾—
    function getDisplayName() {
      if (!state.userName) return '';
      const firstName = getFirstName(state.userName);
      const suffix = state.userGender === 'female' ? 'ã¡ã‚ƒã‚“' : 'ãã‚“';
      return firstName + suffix;
    }

    // å•é¡Œãƒ‡ãƒ¼ã‚¿ï¼ˆå„20å•ï¼‰
    const allQuestions = {
      showa: [
        { q: "ã€Œå·¨äººã®æ˜Ÿã€ã®ä¸»äººå…¬ã®åå‰ã¯ï¼Ÿ", choices: ["æ˜Ÿ é£›é›„é¦¬", "æ˜Ÿ ä¸€å¾¹", "èŠ±å½¢ æº€", "ä¼´ å®™å¤ª"], answer: 0, hint: "ãŠçˆ¶ã•ã‚“ã¯ä¸€å¾¹ã§ã™", era: "æ˜­å’Œ40å¹´ä»£" },
        { q: "ã€Œä¸‰ä¸ç›®ã®å¤•æ—¥ã€ã®èˆå°ã«ãªã£ãŸæ™‚ä»£ã¯ï¼Ÿ", choices: ["æ˜­å’Œ30å¹´ä»£", "æ˜­å’Œ40å¹´ä»£", "æ˜­å’Œ50å¹´ä»£", "å¤§æ­£æ™‚ä»£"], answer: 0, hint: "æ±äº¬ã‚¿ãƒ¯ãƒ¼ãŒã§ããŸé ƒ", era: "æ˜­å’Œ30å¹´ä»£" },
        { q: "ã€Œã‚µã‚¶ã‚¨ã•ã‚“ã€ã®å¼Ÿã®åå‰ã¯ï¼Ÿ", choices: ["ã‚«ãƒ„ã‚ª", "ã‚¿ãƒ©ã‚ª", "ãƒã‚¹ã‚ª", "æ³¢å¹³"], answer: 0, hint: "é­šã®åå‰ã§ã™", era: "æ˜­å’Œ20å¹´ä»£ã€œ" },
        { q: "æ˜­å’Œ39å¹´ã€æ±äº¬ã§é–‹ã‹ã‚ŒãŸå¤§ããªã‚¤ãƒ™ãƒ³ãƒˆã¯ï¼Ÿ", choices: ["ã‚ªãƒªãƒ³ãƒ”ãƒƒã‚¯", "ä¸‡åš", "èŠ±åš", "å›½ä½“"], answer: 0, hint: "ã‚¹ãƒãƒ¼ãƒ„ã®ç¥­å…¸ã§ã™", era: "æ˜­å’Œ39å¹´" },
        { q: "ã€ŒãŠã—ã‚“ã€ã®ä¸»äººå…¬ã®å‡ºèº«åœ°ã¯ï¼Ÿ", choices: ["å±±å½¢çœŒ", "æ–°æ½ŸçœŒ", "ç§‹ç”°çœŒ", "é’æ£®çœŒ"], answer: 0, hint: "ã•ãã‚‰ã‚“ã¼ãŒæœ‰åãªçœŒ", era: "æ˜­å’Œ58å¹´" },
        { q: "ç¾ç©ºã²ã°ã‚Šã•ã‚“ã®ä»£è¡¨æ›²ã€Œå·ã®æµã‚Œã®ã‚ˆã†ã«ã€ã¯ä½•å·ã‚’ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼Ÿ", choices: ["éš…ç”°å·", "å¤šæ‘©å·", "åˆ©æ ¹å·", "è’å·"], answer: 0, hint: "æ±äº¬ã®ä¸‹ç”ºã‚’æµã‚Œã‚‹å·", era: "æ˜­å’Œ63å¹´" },
        { q: "ã€Œç”·ã¯ã¤ã‚‰ã„ã‚ˆã€ã®å¯…ã•ã‚“ã®æ•…éƒ·ã¯ï¼Ÿ", choices: ["æŸ´åˆ", "æµ…è‰", "ä¸Šé‡", "æ·±å·"], answer: 0, hint: "å¸é‡ˆå¤©ãŒã‚ã‚‹ã¨ã“ã‚", era: "æ˜­å’Œ44å¹´ã€œ" },
        { q: "æ˜­å’Œ45å¹´ã®å¤§é˜ªä¸‡åšã®ã‚·ãƒ³ãƒœãƒ«ã¯ï¼Ÿ", choices: ["å¤ªé™½ã®å¡”", "é€šå¤©é–£", "å¤§é˜ªåŸ", "ä¸‡åšã‚¿ãƒ¯ãƒ¼"], answer: 0, hint: "å²¡æœ¬å¤ªéƒã•ã‚“ã®ä½œå“", era: "æ˜­å’Œ45å¹´" },
        { q: "ã€Œã¡ã³ã¾ã‚‹å­ã¡ã‚ƒã‚“ã€ã®èˆå°ã¯ä½•çœŒï¼Ÿ", choices: ["é™å²¡çœŒ", "æ„›çŸ¥çœŒ", "ç¥å¥ˆå·çœŒ", "æ±äº¬éƒ½"], answer: 0, hint: "å¯Œå£«å±±ãŒè¦‹ãˆã‚‹çœŒ", era: "æ˜­å’Œ40å¹´ä»£è¨­å®š" },
        { q: "ã€Œé‰„è…•ã‚¢ãƒˆãƒ ã€ã®ç”Ÿã¿ã®è¦ªã¯ï¼Ÿ", choices: ["æ‰‹å¡šæ²»è™«", "è—¤å­ä¸äºŒé›„", "çŸ³ãƒæ£®ç« å¤ªéƒ", "èµ¤å¡šä¸äºŒå¤«"], answer: 0, hint: "æ¼«ç”»ã®ç¥æ§˜ã¨å‘¼ã°ã‚ŒãŸæ–¹", era: "æ˜­å’Œ38å¹´" },
        { q: "æ˜­å’Œ33å¹´ã«å®Œæˆã—ãŸæ±äº¬ã®ã‚·ãƒ³ãƒœãƒ«ã¯ï¼Ÿ", choices: ["æ±äº¬ã‚¿ãƒ¯ãƒ¼", "ã‚¹ã‚«ã‚¤ãƒ„ãƒªãƒ¼", "æ±äº¬é§…", "å›½ä¼šè­°äº‹å ‚"], answer: 0, hint: "333ãƒ¡ãƒ¼ãƒˆãƒ«ã®é«˜ã•", era: "æ˜­å’Œ33å¹´" },
        { q: "ã€Œ8æ™‚ã ãƒ§ï¼å…¨å“¡é›†åˆã€ã®å¸ä¼šè€…ã¯ï¼Ÿ", choices: ["ã„ã‹ã‚Šã‚„é•·ä»‹", "åŠ è—¤èŒ¶", "å¿—æ‘ã‘ã‚“", "ä»²æœ¬å·¥äº‹"], answer: 0, hint: "ãƒ‰ãƒªãƒ•ã‚¿ãƒ¼ã‚ºã®ãƒªãƒ¼ãƒ€ãƒ¼", era: "æ˜­å’Œ44å¹´ã€œ" },
        { q: "çŸ³åŸè£•æ¬¡éƒã•ã‚“ã®ä»£è¡¨æ›²ã¯ï¼Ÿ", choices: ["åµã‚’å‘¼ã¶ç”·", "åŒ—ã®æ—…äºº", "æ™‚ã®æµã‚Œã«èº«ã‚’ã¾ã‹ã›", "æ´¥è»½æµ·å³¡å†¬æ™¯è‰²"], answer: 0, hint: "ãƒ‰ãƒ©ãƒ ã‚’å©ãæ˜ ç”»ã®ä¸»é¡Œæ­Œ", era: "æ˜­å’Œ32å¹´" },
        { q: "æ˜­å’Œã®ä¸‰ç¨®ã®ç¥å™¨ã§ãªã„ã‚‚ã®ã¯ï¼Ÿ", choices: ["ã‚¨ã‚¢ã‚³ãƒ³", "ãƒ†ãƒ¬ãƒ“", "æ´—æ¿¯æ©Ÿ", "å†·è”µåº«"], answer: 0, hint: "å½“æ™‚ã¯ã¾ã æ™®åŠã—ã¦ã„ãªã‹ã£ãŸ", era: "æ˜­å’Œ30å¹´ä»£" },
        { q: "ã€Œæ°´æˆ¸é»„é–€ã€ã®æ±ºã‚å°è©ã€Œã“ã®â—‹â—‹ãŒç›®ã«å…¥ã‚‰ã¬ã‹ã€", choices: ["å°ç± ", "ç´‹æ‰€", "å®¶ç´‹", "è¨¼æ–‡"], answer: 0, hint: "è‘µã®å¾¡ç´‹ãŒå…¥ã£ã¦ã„ã¾ã™", era: "æ˜­å’Œ44å¹´ã€œ" },
        { q: "é•·å¶‹èŒ‚é›„é¸æ‰‹ã®èƒŒç•ªå·ã¯ï¼Ÿ", choices: ["3", "1", "5", "7"], answer: 0, hint: "ãƒŸã‚¹ã‚¿ãƒ¼ãƒ»ã‚¸ãƒ£ã‚¤ã‚¢ãƒ³ãƒ„", era: "æ˜­å’Œ33å¹´ã€œ" },
        { q: "ã€Œã¨ãªã‚Šã®ãƒˆãƒˆãƒ­ã€ã«å‡ºã¦ãã‚‹ä¹—ã‚Šç‰©ã¯ï¼Ÿ", choices: ["ãƒã‚³ãƒã‚¹", "ã‚¤ãƒŒãƒã‚¹", "ã‚¯ãƒãƒã‚¹", "ã‚¦ã‚µã‚®ãƒã‚¹"], answer: 0, hint: "12æœ¬è¶³ã®å‹•ç‰©ã§ã™", era: "æ˜­å’Œ63å¹´" },
        { q: "ã€Œå¿ çŠ¬ãƒãƒå…¬ã€ã®çŠ¬ç¨®ã¯ï¼Ÿ", choices: ["ç§‹ç”°çŠ¬", "æŸ´çŠ¬", "åœŸä½çŠ¬", "ç”²æ–çŠ¬"], answer: 0, hint: "æ±åŒ—åœ°æ–¹ã®çŠ¬", era: "æ˜­å’ŒåˆæœŸ" },
        { q: "ã€Œã‚²ã‚²ã‚²ã®é¬¼å¤ªéƒã€ã®ä½œè€…ã¯ï¼Ÿ", choices: ["æ°´æœ¨ã—ã’ã‚‹", "æ‰‹å¡šæ²»è™«", "è—¤å­ä¸äºŒé›„", "æ¨ªå±±å…‰è¼"], answer: 0, hint: "å¢ƒæ¸¯å‡ºèº«ã®æ¼«ç”»å®¶", era: "æ˜­å’Œ43å¹´" },
        { q: "æ˜­å’Œå¤©çš‡ã®åœ¨ä½ã¯ä½•å¹´é–“ï¼Ÿ", choices: ["62å¹´", "45å¹´", "50å¹´", "70å¹´"], answer: 0, hint: "æ—¥æœ¬å²ä¸Šæœ€é•·ã§ã—ãŸ", era: "æ˜­å’Œå…ƒå¹´ã€œ64å¹´" },
      ],
      food: [
        { q: "ã€Œã‚«ãƒ¬ãƒ¼ãƒ©ã‚¤ã‚¹ã€ã®å…·æã¨ã—ã¦å®šç•ªã§ãªã„ã‚‚ã®ã¯ï¼Ÿ", choices: ["ãŸã‘ã®ã“", "ã˜ã‚ƒãŒã„ã‚‚", "ã«ã‚“ã˜ã‚“", "ãŸã¾ã­ã"], answer: 0, hint: "æ˜¥ã«æ¡ã‚Œã‚‹é‡èœã§ã™", era: "å®šç•ªæ–™ç†" },
        { q: "ã€Œä¸ƒè‰ãŒã‚†ã€ã‚’é£Ÿã¹ã‚‹ã®ã¯ã„ã¤ï¼Ÿ", choices: ["1æœˆ7æ—¥", "1æœˆ1æ—¥", "1æœˆ15æ—¥", "2æœˆ3æ—¥"], answer: 0, hint: "æ¾ã®å†…ãŒçµ‚ã‚ã‚‹é ƒ", era: "æ—¥æœ¬ã®ä¼çµ±" },
        { q: "ãŠã›ã¡æ–™ç†ã®ã€Œé»’è±†ã€ã«è¾¼ã‚ã‚‰ã‚ŒãŸé¡˜ã„ã¯ï¼Ÿ", choices: ["ã¾ã‚ã«åƒã", "ãŠé‡‘æŒã¡ã«ãªã‚‹", "é•·ç”Ÿãã™ã‚‹", "å­å®ã«æµã¾ã‚Œã‚‹"], answer: 0, hint: "ã€Œã¾ã‚ã€ã¨ã„ã†è¨€è‘‰ãŒãƒ’ãƒ³ãƒˆ", era: "æ—¥æœ¬ã®ä¼çµ±" },
        { q: "ã€Œãƒ©ãƒ ãƒã€ã®ãƒ“ãƒ³ã®ä¸­ã«å…¥ã£ã¦ã„ã‚‹ã‚‚ã®ã¯ï¼Ÿ", choices: ["ãƒ“ãƒ¼ç‰", "ã‚ã‚ç‰", "æ°·", "ãƒ¬ãƒ¢ãƒ³"], answer: 0, hint: "å­ã©ã‚‚ãŒæ¬²ã—ãŒã‚‹ã‚‚ã®", era: "æ˜­å’Œã®é§„è“å­" },
        { q: "æ˜”ã®ã€Œã‹ãæ°·ã€ã®å®šç•ªã®å‘³ã¯ï¼Ÿ", choices: ["ã„ã¡ã”", "ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆ", "æŠ¹èŒ¶", "ãƒãƒ³ã‚´ãƒ¼"], answer: 0, hint: "èµ¤ã„è‰²ã§ã™", era: "å¤ã®é¢¨ç‰©è©©" },
        { q: "ã€ŒåœŸç”¨ã®ä¸‘ã®æ—¥ã€ã«é£Ÿã¹ã‚‹å®šç•ªã¯ï¼Ÿ", choices: ["ã†ãªã", "ã†ã©ã‚“", "ã†ã‚ã¼ã—", "ã†ã«"], answer: 0, hint: "ã€Œã†ã€ã®ã¤ãé£Ÿã¹ç‰©", era: "æ—¥æœ¬ã®ä¼çµ±" },
        { q: "ã€ŒãŠé›‘ç…®ã€ã«å…¥ã‚Œã‚‹ãŠé¤…ã®å½¢ã€é–¢æ±ã¯ï¼Ÿ", choices: ["å››è§’", "ä¸¸", "ä¸‰è§’", "ç´°é•·ã„"], answer: 0, hint: "é–¢è¥¿ã¯ä¸¸é¤…ã§ã™", era: "æ­£æœˆæ–™ç†" },
        { q: "ã€Œã¡ã‚‰ã—å¯¿å¸ã€ã‚’é£Ÿã¹ã‚‹è¡Œäº‹ã¯ï¼Ÿ", choices: ["ã²ãªã¾ã¤ã‚Š", "ã“ã©ã‚‚ã®æ—¥", "ä¸ƒå¤•", "ãŠç›†"], answer: 0, hint: "3æœˆã®å¥³ã®å­ã®ç¯€å¥", era: "æ—¥æœ¬ã®ä¼çµ±" },
        { q: "ã€Œè‚‰ã˜ã‚ƒãŒã€ç™ºç¥¥ã®åœ°ã¨è¨€ã‚ã‚Œã‚‹ã®ã¯ï¼Ÿ", choices: ["èˆé¶´", "æ¨ªé ˆè³€", "ä½ä¸–ä¿", "å‘‰"], answer: 0, hint: "äº¬éƒ½åºœã®æ¸¯ç”º", era: "æ˜æ²»æ™‚ä»£ã€œ" },
        { q: "ã€ŒãŸãã‚ã‚“ã€ã¯ä½•ã‚’æ¼¬ã‘ãŸã‚‚ã®ï¼Ÿ", choices: ["å¤§æ ¹", "ãã‚…ã†ã‚Š", "ç™½èœ", "ãªã™"], answer: 0, hint: "å†¬ã«å¹²ã™é‡èœ", era: "æ—¥æœ¬ã®ä¼çµ±" },
        { q: "ã€ŒãŠã¯ãã€ã¨ã€Œã¼ãŸã‚‚ã¡ã€ã€æ˜¥ã«é£Ÿã¹ã‚‹ã®ã¯ï¼Ÿ", choices: ["ã¼ãŸã‚‚ã¡", "ãŠã¯ã", "ã©ã¡ã‚‰ã‚‚", "å­£ç¯€é–¢ä¿‚ãªã„"], answer: 0, hint: "ç‰¡ä¸¹ã®èŠ±ã®å­£ç¯€", era: "æ—¥æœ¬ã®ä¼çµ±" },
        { q: "ã€Œå†·ã‚„ã—ä¸­è¯ã€ãŒå§‹ã¾ã‚‹å­£ç¯€ã¯ï¼Ÿ", choices: ["å¤", "æ˜¥", "ç§‹", "å†¬"], answer: 0, hint: "æš‘ã„å­£ç¯€ã«é£Ÿã¹ãŸã„", era: "æ˜­å’Œã®é£Ÿæ–‡åŒ–" },
        { q: "ã€Œé§„è“å­å±‹ã€ã§ã‚ˆãå£²ã£ã¦ã„ãŸé£²ã¿ç‰©ã¯ï¼Ÿ", choices: ["ç²‰ã‚¸ãƒ¥ãƒ¼ã‚¹", "ã‚³ãƒ¼ãƒ©", "ç‰›ä¹³", "ãŠèŒ¶"], answer: 0, hint: "æ°´ã§æº¶ã‹ã—ã¦é£²ã‚€", era: "æ˜­å’Œã®é§„è“å­" },
        { q: "ã€Œæ¢…å¹²ã—ã€ã‚’ä½œã‚‹å­£ç¯€ã¯ï¼Ÿ", choices: ["æ¢…é›¨", "æ˜¥", "ç§‹", "å†¬"], answer: 0, hint: "é›¨ã®å¤šã„å­£ç¯€", era: "æ—¥æœ¬ã®ä¼çµ±" },
        { q: "ã€Œå¹´è¶Šã—ãã°ã€ã‚’é£Ÿã¹ã‚‹ç†ç”±ã¯ï¼Ÿ", choices: ["é•·å¯¿ã‚’é¡˜ã†", "é‡‘é‹ã‚¢ãƒƒãƒ—", "å„é™¤ã‘", "å¥åº·ç¥ˆé¡˜"], answer: 0, hint: "ç´°ãé•·ã„ã‹ã‚‰", era: "æ—¥æœ¬ã®ä¼çµ±" },
        { q: "ã€Œæ —ã”é£¯ã€ã‚’é£Ÿã¹ã‚‹å­£ç¯€ã¯ï¼Ÿ", choices: ["ç§‹", "æ˜¥", "å¤", "å†¬"], answer: 0, hint: "åç©«ã®å­£ç¯€", era: "ç§‹ã®å‘³è¦š" },
        { q: "ã€ŒãŠå½¼å²¸ã€ã«ä¾›ãˆã‚‹å®šç•ªã®ãŠè“å­ã¯ï¼Ÿ", choices: ["ãŠã¯ã", "ã¾ã‚“ã˜ã‚…ã†", "ã›ã‚“ã¹ã„", "ã‚ˆã†ã‹ã‚“"], answer: 0, hint: "ã‚ã‚“ã“ã‚’ä½¿ã£ãŸå’Œè“å­", era: "æ—¥æœ¬ã®ä¼çµ±" },
        { q: "ã€Œç¯€åˆ†ã€ã«é£Ÿã¹ã‚‹å¤ªå·»ãã®åå‰ã¯ï¼Ÿ", choices: ["æµæ–¹å·»", "å¤ªå·»ãå¯¿å¸", "é‰„ç«å·»", "ã‹ã£ã±å·»"], answer: 0, hint: "ã‚ã‚‹æ–¹è§’ã‚’å‘ã„ã¦é£Ÿã¹ã‚‹", era: "æ—¥æœ¬ã®ä¼çµ±" },
        { q: "ã€ŒãƒŠãƒãƒªã‚¿ãƒ³ã€ç™ºç¥¥ã®åœ°ã¯ï¼Ÿ", choices: ["æ¨ªæµœ", "æ±äº¬", "å¤§é˜ª", "ç¥æˆ¸"], answer: 0, hint: "æ¸¯ç”ºã®ãƒ›ãƒ†ãƒ«ã§ç”Ÿã¾ã‚ŒãŸ", era: "æ˜­å’Œã®æ´‹é£Ÿ" },
        { q: "ã€Œå­¦æ ¡çµ¦é£Ÿã€ã§äººæ°—ã ã£ãŸæšã’ãƒ‘ãƒ³ã®ä¸­èº«ã¯ï¼Ÿ", choices: ["ããªã“", "ã‚ã‚“ã“", "ã‚¯ãƒªãƒ¼ãƒ ", "ã‚¸ãƒ£ãƒ "], answer: 0, hint: "å¤§è±†ã‹ã‚‰ä½œã‚‹ç²‰", era: "æ˜­å’Œã®çµ¦é£Ÿ" },
      ],
      culture: [
        { q: "ã€Œã„ã‚ã¯ã«ã»ã¸ã¨ã€ã®æ¬¡ã«æ¥ã‚‹ã®ã¯ï¼Ÿ", choices: ["ã¡ã‚Šã¬ã‚‹ã‚’", "ã‚ã‹ã‚ˆãŸã‚Œã", "ã¤ã­ãªã‚‰ã‚€", "ã‚ã•ãã‚†ã‚ã¿ã—"], answer: 0, hint: "æ•£ã£ã¦è½ã¡ã‚‹ã‚‚ã®", era: "æ—¥æœ¬ã®ä¼çµ±" },
        { q: "ã€Œæ¡ƒå¤ªéƒã€ã®ãŠä¾›ã¯çŠ¬ã€çŒ¿ã¨ä½•ï¼Ÿ", choices: ["ãã˜", "ã†ã•ã", "ãŸã¬ã", "ã‹ã‚"], answer: 0, hint: "é³¥ã®ä»²é–“ã§ã™", era: "æ˜”è©±" },
        { q: "ã€Œä¸€å¯¸æ³•å¸«ã€ã¯ã©ã“ã‹ã‚‰ç”Ÿã¾ã‚ŒãŸï¼Ÿ", choices: ["ãŠã°ã‚ã•ã‚“ã®æŒ‡", "æ¡ƒã®ä¸­", "ç«¹ã®ä¸­", "å·ã‹ã‚‰"], answer: 0, hint: "ã¨ã¦ã‚‚å°ã•ãç”Ÿã¾ã‚Œã¾ã—ãŸ", era: "æ˜”è©±" },
        { q: "ã€Œä¸ƒå¤•ã€ã§é¡˜ã„äº‹ã‚’æ›¸ãã®ã¯ä½•ã«ï¼Ÿ", choices: ["çŸ­å†Š", "çµµé¦¬", "ãŠã¿ãã˜", "ã ã‚‹ã¾"], answer: 0, hint: "ç¬¹ã«é£¾ã‚Šã¾ã™", era: "æ—¥æœ¬ã®ä¼çµ±" },
        { q: "ã€ŒãŠæœˆè¦‹ã€ã«é£¾ã‚‹å›£å­ã®æ•°ã¯ï¼Ÿ", choices: ["15å€‹", "10å€‹", "20å€‹", "7å€‹"], answer: 0, hint: "åäº”å¤œã«ã¡ãªã‚“ã§", era: "æ—¥æœ¬ã®ä¼çµ±" },
        { q: "ã€Œç´…ç™½æ­Œåˆæˆ¦ã€ãŒå§‹ã¾ã£ãŸã®ã¯ï¼Ÿ", choices: ["æ˜­å’Œ26å¹´", "æ˜­å’Œ20å¹´", "æ˜­å’Œ35å¹´", "æ˜­å’Œ45å¹´"], answer: 0, hint: "æˆ¦å¾Œã¾ã‚‚ãªãã§ã™", era: "æ˜­å’Œ26å¹´ã€œ" },
        { q: "ã€Œã‹ãã‚„å§«ã€ã¯ã©ã“ã§è¦‹ã¤ã‹ã£ãŸï¼Ÿ", choices: ["ç«¹ã®ä¸­", "æ¡ƒã®ä¸­", "å·ã®ä¸­", "æ£®ã®ä¸­"], answer: 0, hint: "å…‰ã‚‹æ¤ç‰©ã®ä¸­", era: "æ˜”è©±" },
        { q: "ã€Œæµ¦å³¶å¤ªéƒã€ãŒåŠ©ã‘ãŸå‹•ç‰©ã¯ï¼Ÿ", choices: ["äº€", "é­š", "é³¥", "çŠ¬"], answer: 0, hint: "æµ·ã®ç”Ÿãç‰©", era: "æ˜”è©±" },
        { q: "ã€Œã“ã©ã‚‚ã®æ—¥ã€ã«é£¾ã‚‹ã‚‚ã®ã¯ï¼Ÿ", choices: ["ã“ã„ã®ã¼ã‚Š", "ã²ãªäººå½¢", "é–€æ¾", "ã—ã‚ç¸„"], answer: 0, hint: "ç©ºã‚’æ³³ãã‚‚ã®", era: "æ—¥æœ¬ã®ä¼çµ±" },
        { q: "ã€ŒãŠæ­£æœˆã€ã«é£¾ã‚‹æ¤ç‰©ã¯æ¾ã¨ç«¹ã¨ï¼Ÿ", choices: ["æ¢…", "æ¡œ", "èŠ", "è—¤"], answer: 0, hint: "æ¾ç«¹â—‹", era: "æ—¥æœ¬ã®ä¼çµ±" },
        { q: "ã€ŒèŠ±å’²ã‹ã˜ã„ã•ã‚“ã€ãŒå’²ã‹ã›ãŸèŠ±ã¯ï¼Ÿ", choices: ["æ¡œ", "æ¢…", "æ¡ƒ", "èŠ"], answer: 0, hint: "æ—¥æœ¬ã‚’ä»£è¡¨ã™ã‚‹èŠ±", era: "æ˜”è©±" },
        { q: "ã€Œé‡‘å¤ªéƒã€ãŒä½ã‚“ã§ã„ãŸå±±ã¯ï¼Ÿ", choices: ["è¶³æŸ„å±±", "å¯Œå£«å±±", "ç­‘æ³¢å±±", "é«˜å°¾å±±"], answer: 0, hint: "ç¥å¥ˆå·çœŒã¨é™å²¡çœŒã®å¢ƒ", era: "æ˜”è©±" },
        { q: "ã€Œæˆäººå¼ã€ã¯ä½•æ­³ã®ãŠç¥ã„ï¼Ÿ", choices: ["20æ­³", "18æ­³", "25æ­³", "15æ­³"], answer: 0, hint: "å¤§äººã«ãªã‚‹ç¯€ç›®ï¼ˆç¾åœ¨ã¯18æ­³ï¼‰", era: "æ—¥æœ¬ã®ä¼çµ±" },
        { q: "ã€Œä¸ƒäº”ä¸‰ã€ã§ãŠå‚ã‚Šã—ãªã„å¹´é½¢ã¯ï¼Ÿ", choices: ["4æ­³", "3æ­³", "5æ­³", "7æ­³"], answer: 0, hint: "å¥‡æ•°ã®å¹´é½¢ã‚’ãŠç¥ã„", era: "æ—¥æœ¬ã®ä¼çµ±" },
        { q: "ã€Œé™¤å¤œã®é˜ã€ã¯ä½•å›ã¤ãï¼Ÿ", choices: ["108å›", "100å›", "112å›", "88å›"], answer: 0, hint: "ç…©æ‚©ã®æ•°", era: "æ—¥æœ¬ã®ä¼çµ±" },
        { q: "ã€ŒèˆŒåˆ‡ã‚Šé›€ã€ã§ãŠã°ã‚ã•ã‚“ãŒã‚‚ã‚‰ã£ãŸã¤ã¥ã‚‰ã¯ï¼Ÿ", choices: ["å¤§ãã„ã¤ã¥ã‚‰", "å°ã•ã„ã¤ã¥ã‚‰", "ä¸­ãã‚‰ã„", "ä¸¡æ–¹"], answer: 0, hint: "æ¬²å¼µã£ãŸæ–¹", era: "æ˜”è©±" },
        { q: "ã€Œã•ã‚‹ã‹ã«åˆæˆ¦ã€ã§ã‹ã«ã®æ•µã‚’è¨ã£ãŸã®ã¯ï¼Ÿ", choices: ["æ —ãƒ»èœ‚ãƒ»è‡¼", "çŠ¬ãƒ»çŒ¿ãƒ»é›‰", "äº€ãƒ»é¶´ãƒ»è›™", "ç‹¸ãƒ»ç‹ãƒ»ç†Š"], answer: 0, hint: "å°ã•ãªä»²é–“ãŸã¡", era: "æ˜”è©±" },
        { q: "ã€Œç«¯åˆã®ç¯€å¥ã€ã«é£¾ã‚‹èŠ±ã¯ï¼Ÿ", choices: ["è–è’²", "æ¡œ", "æ¢…", "è—¤"], answer: 0, hint: "ãŠé¢¨å‘‚ã«ã‚‚å…¥ã‚Œã¾ã™", era: "æ—¥æœ¬ã®ä¼çµ±" },
        { q: "ã€ŒãŠç›†ã€ã«å…ˆç¥–ã®éœŠãŒä¹—ã£ã¦ãã‚‹ã‚‚ã®ã¯ï¼Ÿ", choices: ["ãã‚…ã†ã‚Šã®é¦¬", "ãªã™ã®é¦¬", "å¤§æ ¹ã®é¦¬", "ã«ã‚“ã˜ã‚“ã®é¦¬"], answer: 0, hint: "æ—©ãæ¥ã¦ã»ã—ã„ã‹ã‚‰", era: "æ—¥æœ¬ã®ä¼çµ±" },
        { q: "ã€Œå¹²æ”¯ã€ã§æœ€åˆã®å‹•ç‰©ã¯ï¼Ÿ", choices: ["ã­ãšã¿", "ã†ã—", "ã¨ã‚‰", "ã†ã•ã"], answer: 0, hint: "ä¸€ç•ªå°ã•ã„ã‘ã©è³¢ã‹ã£ãŸ", era: "æ—¥æœ¬ã®ä¼çµ±" },
      ],
      proverb: [
        { q: "ã€ŒçŒ¿ã‚‚æœ¨ã‹ã‚‰â—‹â—‹â—‹ã€", choices: ["è½ã¡ã‚‹", "ç™»ã‚‹", "é™ã‚Šã‚‹", "é£›ã¶"], answer: 0, hint: "ä¸Šæ‰‹ãªäººã‚‚å¤±æ•—ã™ã‚‹ã“ã¨ãŒã‚ã‚‹", era: "ã“ã¨ã‚ã–" },
        { q: "ã€ŒçŸ³ã®ä¸Šã«ã‚‚â—‹â—‹ã€", choices: ["ä¸‰å¹´", "åå¹´", "ç™¾å¹´", "ä¸€å¹´"], answer: 0, hint: "è¾›æŠ±å¼·ãç¶šã‘ã‚‹ã“ã¨", era: "ã“ã¨ã‚ã–" },
        { q: "ã€ŒèŠ±ã‚ˆã‚Šâ—‹â—‹â—‹ã€", choices: ["å›£å­", "é…’", "æœˆ", "é›ª"], answer: 0, hint: "é£Ÿã¹ç‰©ã§ã™", era: "ã“ã¨ã‚ã–" },
        { q: "ã€Œæ—©èµ·ãã¯ä¸‰æ–‡ã®â—‹â—‹ã€", choices: ["å¾³", "å¾—", "ç‰¹", "æ¯’"], answer: 0, hint: "ã„ã„ã“ã¨ãŒã‚ã‚‹", era: "ã“ã¨ã‚ã–" },
        { q: "ã€Œä¸ƒè»¢ã³â—‹â—‹èµ·ãã€", choices: ["å…«", "ä¸ƒ", "ä¹", "å"], answer: 0, hint: "è»¢ã‚“ã æ•°ã‚ˆã‚Šå¤šã„", era: "ã“ã¨ã‚ã–" },
        { q: "ã€Œç¬‘ã†é–€ã«ã¯â—‹â—‹æ¥ã‚‹ã€", choices: ["ç¦", "é‹", "é‡‘", "æ˜¥"], answer: 0, hint: "å¹¸ã›ãŒæ¥ã‚‹", era: "ã“ã¨ã‚ã–" },
        { q: "ã€ŒçŠ¬ã‚‚æ­©ã‘ã°â—‹â—‹ã«å½“ãŸã‚‹ã€", choices: ["æ£’", "çŸ³", "äºº", "æœ¨"], answer: 0, hint: "æ€ã„ãŒã‘ãªã„ã“ã¨ãŒèµ·ã“ã‚‹", era: "ã“ã¨ã‚ã–" },
        { q: "ã€Œé ­éš ã—ã¦â—‹â—‹éš ã•ãšã€", choices: ["å°»", "è¶³", "æ‰‹", "è€³"], answer: 0, hint: "é³¥ã®é›‰ã®ã‚ˆã†ã«", era: "ã“ã¨ã‚ã–" },
        { q: "ã€Œä¸‰äººå¯„ã‚Œã°â—‹â—‹ã®çŸ¥æµã€", choices: ["æ–‡æ®Š", "ä»", "ç¥", "å¤©"], answer: 0, hint: "ä»æ•™ã®è©è–©æ§˜", era: "ã“ã¨ã‚ã–" },
        { q: "ã€Œå¡µã‚‚ç©ã‚‚ã‚Œã°â—‹â—‹ã¨ãªã‚‹ã€", choices: ["å±±", "å·", "æµ·", "æ£®"], answer: 0, hint: "é«˜ãç©ã¿ä¸ŠãŒã‚‹", era: "ã“ã¨ã‚ã–" },
        { q: "ã€Œæ€¥ãŒã°â—‹â—‹â—‹ã€", choices: ["å›ã‚Œ", "èµ°ã‚Œ", "æ­¢ã¾ã‚Œ", "é€²ã‚"], answer: 0, hint: "è¿‘é“ã‚ˆã‚Šç¢ºå®Ÿãªé“", era: "ã“ã¨ã‚ã–" },
        { q: "ã€Œé¬¼ã«â—‹â—‹â—‹ã€", choices: ["é‡‘æ£’", "è§’", "è±†", "ç«"], answer: 0, hint: "å¼·ã„è€…ãŒã•ã‚‰ã«å¼·ããªã‚‹", era: "ã“ã¨ã‚ã–" },
        { q: "ã€Œç›®ã¯å£ã»ã©ã«â—‹â—‹ã‚’è¨€ã†ã€", choices: ["ç‰©", "äº‹", "è¨€è‘‰", "å¿ƒ"], answer: 0, hint: "è¡¨æƒ…ã§ä¼ã‚ã‚‹", era: "ã“ã¨ã‚ã–" },
        { q: "ã€Œé¦¬ã®è€³ã«â—‹â—‹â—‹ã€", choices: ["å¿µä»", "æ­Œ", "é¢¨", "æ°´"], answer: 0, hint: "è¨€ã£ã¦ã‚‚ç„¡é§„", era: "ã“ã¨ã‚ã–" },
        { q: "ã€ŒçŒ«ã«â—‹â—‹â—‹ã€", choices: ["å°åˆ¤", "é­š", "éˆ´", "é¤Œ"], answer: 0, hint: "ä¾¡å€¤ãŒã‚ã‹ã‚‰ãªã„", era: "ã“ã¨ã‚ã–" },
        { q: "ã€Œé›¨é™ã£ã¦â—‹â—‹å›ºã¾ã‚‹ã€", choices: ["åœ°", "åœŸ", "é“", "çŸ³"], answer: 0, hint: "å›°é›£ã®å¾Œã¯è‰¯ããªã‚‹", era: "ã“ã¨ã‚ã–" },
        { q: "ã€Œå¼˜æ³•ã«ã‚‚â—‹â—‹ã®èª¤ã‚Šã€", choices: ["ç­†", "å­—", "å¢¨", "ç´™"], answer: 0, hint: "æ›¸é“ã®é”äººã§ã‚‚", era: "ã“ã¨ã‚ã–" },
        { q: "ã€Œæ£šã‹ã‚‰â—‹â—‹â—‹ã€", choices: ["ã¼ãŸã‚‚ã¡", "ã¾ã‚“ã˜ã‚…ã†", "ãŠã¯ã", "ã ã‚“ã”"], answer: 0, hint: "æ€ã„ãŒã‘ãªã„å¹¸é‹", era: "ã“ã¨ã‚ã–" },
        { q: "ã€ŒäºŒéšã‹ã‚‰â—‹â—‹â—‹ã€", choices: ["ç›®è–¬", "æ°´", "çŸ³", "å£°"], answer: 0, hint: "ã‚‚ã©ã‹ã—ã„ã“ã¨", era: "ã“ã¨ã‚ã–" },
        { q: "ã€Œç™¾èã¯ä¸€â—‹â—‹ã«ã—ã‹ãšã€", choices: ["è¦‹", "è", "è¨€", "çŸ¥"], answer: 0, hint: "å®Ÿéš›ã«è¦‹ã‚‹ã“ã¨ãŒå¤§äº‹", era: "ã“ã¨ã‚ã–" },
      ],
    };

    const categories = [
      { id: 'showa', name: 'æ˜­å’Œã®æ€ã„å‡º', icon: 'ğŸ“º' },
      { id: 'food', name: 'æ‡ã‹ã—ã®å‘³', icon: 'ğŸ™' },
      { id: 'culture', name: 'æ—¥æœ¬ã®æ–‡åŒ–', icon: 'ğŸ' },
      { id: 'proverb', name: 'ã“ã¨ã‚ã–', icon: 'ğŸ“–' },
    ];

    // ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®è¡¨æƒ…
    function getCharacter() {
      const name = getDisplayName();
      if (state.feedback === 'correct') {
        return { emoji: 'ğŸ˜„', message: name ? `${name}ã€ã™ã°ã‚‰ã—ã„ï¼` : 'ã™ã°ã‚‰ã—ã„ï¼' };
      }
      if (state.feedback === 'wrong') {
        return { emoji: 'ğŸ˜Š', message: name ? `${name}ã€æƒœã—ã„ï¼æ¬¡ã¯å½“ãŸã‚‹ã‚ã‚ˆ` : 'æƒœã—ã„ï¼æ¬¡ã¯å½“ãŸã‚‹ã‚ã‚ˆ' };
      }
      if (state.streak >= 3) {
        return { emoji: 'ğŸŒŸ', message: name ? `${name}ã€çµ¶å¥½èª¿ã§ã™ã­ï¼` : 'çµ¶å¥½èª¿ã§ã™ã­ï¼' };
      }
      return { emoji: 'ğŸ˜Š', message: name ? `${name}ã€è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†` : 'è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†' };
    }

    // ã‚·ãƒ£ãƒƒãƒ•ãƒ«é–¢æ•°
    function shuffle(array) {
      const arr = [...array];
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // ã‚«ãƒ†ã‚´ãƒªãƒ¼é¸æŠ
    function selectCategory(catId) {
      state.category = catId;
      state.questions = shuffle(allQuestions[catId]);
      state.screen = 'quiz';
      state.currentQ = 0;
      state.score = 0;
      state.streak = 0;
      state.feedback = null;
      state.selectedAnswer = null;
      state.showHint = false;
      render();
    }

    // å›ç­”å‡¦ç†
    function handleAnswer(idx) {
      if (state.feedback !== null) return;
      
      state.selectedAnswer = idx;
      const correct = idx === state.questions[state.currentQ].answer;
      state.feedback = correct ? 'correct' : 'wrong';
      
      if (correct) {
        state.score += 10 + state.streak * 2;
        state.streak += 1;
      } else {
        state.streak = 0;
      }
      
      render();
      
      setTimeout(() => {
        state.feedback = null;
        state.selectedAnswer = null;
        state.showHint = false;
        if (state.currentQ < state.questions.length - 1) {
          state.currentQ += 1;
        } else {
          state.screen = 'result';
        }
        render();
      }, 2000);
    }

    // ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°é–¢æ•°
    function render() {
      const app = document.getElementById('app');
      const name = getDisplayName();

      // ã‚¦ã‚§ãƒ«ã‚«ãƒ ç”»é¢
      if (state.screen === 'welcome') {
        app.innerHTML = `
          <div class="min-h-screen p-6 flex flex-col items-center justify-center">
            <div class="text-center mb-8">
              <div class="text-7xl mb-4">ğŸ§ âœ¨</div>
              <h1 class="text-3xl font-bold text-gray-700 mb-2" style="text-shadow: 2px 2px 4px rgba(255,255,255,0.8), -1px -1px 2px rgba(0,0,0,0.1)">
                ãªã¤ã‹ã—ã‚¯ã‚¤ã‚º
              </h1>
              <p class="text-xl text-gray-600 mb-2">é ­ã®ä½“æ“ã‚’ã—ã¾ã—ã‚‡ã†</p>
            </div>

            <div class="w-full max-w-md space-y-5">
              <button onclick="state.screen = 'nameInput'; render();" class="w-full p-6 rounded-2xl neu-btn">
                <div class="flex items-center justify-center gap-4">
                  <span class="text-4xl">ğŸ‘‹</span>
                  <div class="text-left">
                    <div class="text-2xl font-bold text-gray-700">ãŠåå‰ã‚’ç™»éŒ²ã™ã‚‹</div>
                    <div class="text-gray-500">åå‰ã§å‘¼ã³ã‹ã‘ã¾ã™</div>
                  </div>
                </div>
              </button>

              <button onclick="state.userName = ''; state.userGender = null; state.screen = 'categorySelect'; render();" class="w-full p-5 rounded-2xl neu-btn-sm">
                <div class="flex items-center justify-center gap-3">
                  <span class="text-3xl">â–¶ï¸</span>
                  <span class="text-xl font-bold text-gray-600">ä»Šã™ãå§‹ã‚ã‚‹</span>
                </div>
              </button>
            </div>
          </div>
        `;
        return;
      }

      // åå‰å…¥åŠ›ç”»é¢
      if (state.screen === 'nameInput') {
        app.innerHTML = `
          <div class="min-h-screen p-6 flex flex-col items-center justify-center">
            <div class="text-center mb-6">
              <div class="text-6xl mb-3">ğŸ˜Š</div>
              <h2 class="text-2xl font-bold text-gray-700">ãŠåå‰ã‚’æ•™ãˆã¦ã­</h2>
              <p class="text-lg text-gray-600 font-bold mt-2">ä¸‹ã®ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
            </div>

            <div class="w-full max-w-md space-y-6">
              <div class="p-4 rounded-2xl neu-inset">
                <input
                  type="text"
                  id="nameInput"
                  placeholder="ãªã¾ãˆ"
                  class="w-full text-center text-2xl font-bold text-gray-700 bg-transparent outline-none py-3"
                />
              </div>

              <div class="text-center mb-2">
                <p class="text-lg text-gray-600 mb-3">æ€§åˆ¥ã‚’é¸ã‚“ã§ã­</p>
                <div class="flex gap-4 justify-center">
                  <button id="femaleBtn" onclick="selectGender('female');" class="flex-1 py-5 px-6 rounded-2xl text-xl font-bold text-gray-600 neu-btn-sm">
                    <div class="text-4xl mb-1">ğŸ‘©</div>
                    å¥³æ€§
                  </button>
                  <button id="maleBtn" onclick="selectGender('male');" class="flex-1 py-5 px-6 rounded-2xl text-xl font-bold text-gray-600 neu-btn-sm">
                    <div class="text-4xl mb-1">ğŸ‘¨</div>
                    ç”·æ€§
                  </button>
                </div>
              </div>

              <button id="submitBtn" onclick="submitName();" class="w-full py-5 px-8 rounded-2xl text-2xl font-bold neu-btn text-gray-400" style="opacity: 0.6">
                âœ¨ æ±ºå®š
              </button>

              <button onclick="state.screen = 'welcome'; render();" class="w-full py-4 rounded-xl text-lg text-gray-500 neu-btn-sm">
                â† æˆ»ã‚‹
              </button>

              <button onclick="state.userName = ''; state.userGender = null; state.screen = 'categorySelect'; render();" class="w-full py-4 rounded-xl text-lg text-gray-500 neu-btn-sm">
                â–¶ï¸ ä»Šã™ãå§‹ã‚ã‚‹
                <div class="text-sm text-gray-400 mt-1">â€»åå‰ã‚’å…¥åŠ›ã—ãªã„ã§å§‹ã‚ã‚‹</div>
              </button>
            </div>
          </div>
        `;
        
        // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ãƒœã‚¿ãƒ³ã®è¨­å®š
        setTimeout(() => {
          const input = document.getElementById('nameInput');
          const submitBtn = document.getElementById('submitBtn');
          const femaleBtn = document.getElementById('femaleBtn');
          const maleBtn = document.getElementById('maleBtn');
          let tempName = '';
          let tempGender = null;
          
          if (input) {
            input.focus();
            input.addEventListener('input', function() {
              tempName = this.value;
              updateSubmitButton();
            });
          }
          
          window.selectGender = function(gender) {
            tempGender = gender;
            
            // ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ«æ›´æ–°
            if (gender === 'female') {
              femaleBtn.className = 'flex-1 py-5 px-6 rounded-2xl text-xl font-bold text-pink-600 selected-female';
              maleBtn.className = 'flex-1 py-5 px-6 rounded-2xl text-xl font-bold text-gray-600 neu-btn-sm';
            } else {
              maleBtn.className = 'flex-1 py-5 px-6 rounded-2xl text-xl font-bold text-blue-600 selected-male';
              femaleBtn.className = 'flex-1 py-5 px-6 rounded-2xl text-xl font-bold text-gray-600 neu-btn-sm';
            }
            updateSubmitButton();
          };
          
          window.submitName = function() {
            if (tempName.trim() && tempGender) {
              state.userName = tempName.trim();
              state.userGender = tempGender;
              state.screen = 'categorySelect';
              render();
            }
          };
          
          function updateSubmitButton() {
            const canSubmit = tempName.trim() && tempGender;
            if (submitBtn) {
              submitBtn.style.opacity = canSubmit ? '1' : '0.6';
              if (canSubmit) {
                submitBtn.className = 'w-full py-5 px-8 rounded-2xl text-2xl font-bold text-green-600 submit-btn-active';
              } else {
                submitBtn.className = 'w-full py-5 px-8 rounded-2xl text-2xl font-bold neu-btn text-gray-400';
              }
            }
          }
        }, 50);
        return;
      }

      // ã‚«ãƒ†ã‚´ãƒªãƒ¼é¸æŠç”»é¢
      if (state.screen === 'categorySelect') {
        const greeting = name ? `${name}ã€ä»Šæ—¥ã‚‚é ­ã®ä½“æ“ã—ã¾ã—ã‚‡ã†ï¼` : 'é ­ã®ä½“æ“ã‚’ã—ã¾ã—ã‚‡ã†';
        const selectMsg = name ? `${name}ã€å¥½ããªã‚¸ãƒ£ãƒ³ãƒ«ã‚’é¸ã‚“ã§ã­` : 'å¥½ããªã‚¸ãƒ£ãƒ³ãƒ«ã‚’é¸ã‚“ã§ã­';
        
        app.innerHTML = `
          <div class="min-h-screen p-6 flex flex-col items-center justify-center">
            <div class="text-center mb-8">
              <div class="text-6xl mb-4">ğŸ§ âœ¨</div>
              <h1 class="text-3xl font-bold text-gray-700 mb-2" style="text-shadow: 2px 2px 4px rgba(255,255,255,0.8), -1px -1px 2px rgba(0,0,0,0.1)">
                ãªã¤ã‹ã—ã‚¯ã‚¤ã‚º
              </h1>
              <p class="text-xl text-gray-600">${greeting}</p>
            </div>

            <div class="w-full max-w-md space-y-4">
              <p class="text-center text-gray-600 text-lg mb-4">${selectMsg}</p>
              ${categories.map(cat => `
                <button onclick="selectCategory('${cat.id}');" class="w-full p-6 rounded-2xl text-left neu-btn">
                  <div class="flex items-center gap-4">
                    <span class="text-5xl">${cat.icon}</span>
                    <div>
                      <span class="text-2xl font-bold text-gray-700">${cat.name}</span>
                      <div class="text-sm text-gray-500">å…¨20å•</div>
                    </div>
                  </div>
                </button>
              `).join('')}
            </div>
          </div>
        `;
        return;
      }

      // çµæœç”»é¢
      if (state.screen === 'result') {
        const correctCount = Math.round(state.score / 10);
        const percentage = Math.round((correctCount / state.questions.length) * 100);
        
        let result;
        if (percentage >= 80) {
          result = { emoji: 'ğŸ‰', text: name ? `${name}ã€ç´ æ™´ã‚‰ã—ã„ï¼å¤©æ‰ã§ã™ï¼` : 'ç´ æ™´ã‚‰ã—ã„ï¼å¤©æ‰ã§ã™ï¼' };
        } else if (percentage >= 60) {
          result = { emoji: 'ğŸ˜„', text: name ? `${name}ã€ã‚ˆãã§ãã¾ã—ãŸï¼` : 'ã‚ˆãã§ãã¾ã—ãŸï¼' };
        } else if (percentage >= 40) {
          result = { emoji: 'ğŸ˜Š', text: name ? `${name}ã€ãªã‹ãªã‹ä¸Šæ‰‹ã§ã™ï¼` : 'ãªã‹ãªã‹ä¸Šæ‰‹ã§ã™ï¼' };
        } else {
          result = { emoji: 'ğŸ’ª', text: name ? `${name}ã€ã¾ãŸæŒ‘æˆ¦ã—ã¾ã—ã‚‡ã†ï¼` : 'ã¾ãŸæŒ‘æˆ¦ã—ã¾ã—ã‚‡ã†ï¼' };
        }
        
        app.innerHTML = `
          <div class="min-h-screen p-6 flex flex-col items-center justify-center">
            <div class="w-full max-w-md text-center">
              <div class="text-8xl mb-6 animate-bounce">${result.emoji}</div>
              
              <div class="p-8 rounded-3xl mb-6 neu-card">
                <h2 class="text-3xl font-bold text-gray-700 mb-4">${result.text}</h2>
                <div class="text-6xl font-bold text-gray-800 mb-2">${state.score}ç‚¹</div>
                <p class="text-xl text-gray-600">${state.questions.length}å•ä¸­ æ­£è§£ç‡ ${percentage}%</p>
              </div>

              <div class="space-y-4">
                <button onclick="selectCategory('${state.category}');" class="w-full py-5 px-8 rounded-2xl text-2xl font-bold text-gray-700 neu-btn">
                  ğŸ”„ ã‚‚ã†ä¸€åº¦
                </button>
                <button onclick="state.screen = 'categorySelect'; render();" class="w-full py-5 px-8 rounded-2xl text-2xl font-bold text-gray-700 neu-btn">
                  ğŸ  ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠã¸
                </button>
              </div>
            </div>
          </div>
        `;
        return;
      }

      // ã‚¯ã‚¤ã‚ºç”»é¢
      if (state.screen === 'quiz') {
        const currentQuestion = state.questions[state.currentQ];
        const character = getCharacter();
        const currentCat = categories.find(c => c.id === state.category);
        const progress = ((state.currentQ + 1) / state.questions.length) * 100;
        
        const choiceLabels = ['ã‚', 'ã„', 'ã†', 'ãˆ'];
        
        let choicesHTML = currentQuestion.choices.map((choice, idx) => {
          let btnClass = 'neu-btn text-gray-700';
          let icon = '';
          
          if (state.feedback !== null) {
            if (idx === currentQuestion.answer) {
              btnClass = 'correct-btn text-white';
              icon = '<span class="text-2xl">â­•</span>';
            } else if (idx === state.selectedAnswer && state.feedback === 'wrong') {
              btnClass = 'wrong-btn text-white';
              icon = '<span class="text-2xl">âŒ</span>';
            }
          }
          
          return `
            <button onclick="handleAnswer(${idx});" ${state.feedback !== null ? 'disabled' : ''} class="w-full py-5 px-6 rounded-2xl text-xl font-bold ${btnClass}">
              <div class="flex items-center gap-4">
                <span class="w-10 h-10 rounded-full flex items-center justify-center text-lg" style="background: rgba(255,255,255,0.3)">
                  ${choiceLabels[idx]}
                </span>
                <span class="flex-1 text-left">${choice}</span>
                ${icon}
              </div>
            </button>
          `;
        }).join('');
        
        let hintHTML = '';
        if (!state.showHint && state.feedback === null) {
          hintHTML = `
            <div class="text-center mb-4">
              <button onclick="state.showHint = true; render();" class="px-6 py-3 rounded-xl text-lg text-gray-500 neu-btn-sm">
                ğŸ’¡ ãƒ’ãƒ³ãƒˆã‚’è¦‹ã‚‹
              </button>
            </div>
          `;
        } else if (state.showHint) {
          hintHTML = `
            <div class="mb-4 p-4 rounded-xl text-center text-lg text-amber-600 neu-progress">
              ğŸ’¡ ${currentQuestion.hint}
            </div>
          `;
        }
        
        let feedbackOverlay = '';
        if (state.feedback) {
          const overlayEmoji = state.feedback === 'correct' ? 'ğŸ‰' : 'ğŸ˜Š';
          const animClass = state.feedback === 'correct' ? 'animate-bounce' : 'animate-pulse';
          feedbackOverlay = `
            <div class="fixed inset-0 flex items-center justify-center pointer-events-none z-50">
              <div class="text-8xl ${animClass}">${overlayEmoji}</div>
            </div>
          `;
        }
        
        app.innerHTML = `
          <div class="min-h-screen p-4 pb-8">
            <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
            <div class="flex justify-between items-center mb-4 px-2">
              <button onclick="state.screen = 'categorySelect'; render();" class="p-3 rounded-xl text-xl neu-btn-sm">
                â† æˆ»ã‚‹
              </button>
              <div class="text-center">
                <div class="text-lg font-bold text-gray-600">
                  ${currentCat.icon} ${currentCat.name}
                </div>
              </div>
              <div class="p-3 rounded-xl text-center min-w-[80px] neu-btn-sm">
                <div class="text-xs text-gray-500">å¾—ç‚¹</div>
                <div class="text-xl font-bold text-gray-700">${state.score}</div>
              </div>
            </div>

            <!-- é€²æ—ãƒãƒ¼ -->
            <div class="mb-6 px-2">
              <div class="flex justify-between text-sm text-gray-500 mb-2">
                <span>å•é¡Œ ${state.currentQ + 1} / ${state.questions.length}</span>
                ${state.streak >= 2 ? `<span class="text-orange-500 font-bold">ğŸ”¥ ${state.streak}é€£ç¶šæ­£è§£ï¼</span>` : ''}
              </div>
              <div class="h-4 rounded-full overflow-hidden neu-progress">
                <div class="h-full rounded-full bg-gradient-to-r from-green-400 to-emerald-500 transition-all duration-500" style="width: ${progress}%"></div>
              </div>
            </div>

            <!-- ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ -->
            <div class="flex items-center justify-center gap-3 mb-6">
              <span class="text-5xl ${state.feedback === 'correct' ? 'animate-bounce' : ''}">${character.emoji}</span>
              <div class="p-3 px-5 rounded-2xl text-lg text-gray-600 neu-btn-sm">
                ${character.message}
              </div>
            </div>

            <!-- å•é¡Œã‚«ãƒ¼ãƒ‰ -->
            <div class="mb-6 p-6 rounded-3xl neu-card">
              <div class="text-sm text-gray-400 mb-2">${currentQuestion.era}</div>
              <h2 class="text-2xl font-bold text-gray-700 leading-relaxed">${currentQuestion.q}</h2>
            </div>

            <!-- ãƒ’ãƒ³ãƒˆ -->
            ${hintHTML}

            <!-- é¸æŠè‚¢ -->
            <div class="space-y-4">
              ${choicesHTML}
            </div>

            <!-- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
            ${feedbackOverlay}
          </div>
        `;
      }
    }

    // åˆæœŸãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
    render();
  </script>
</body>
</html>
